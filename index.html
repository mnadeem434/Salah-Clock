<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Salah Prayer Clock with Animated Icons & Dynamic Background</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f2f4f5;
    color: #222;
    transition: background 1s ease, color 1s ease;
  }
  .container {
    max-width: 420px;
    margin: 1rem auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 20px #0002;
    padding: 1.2rem;
  }
  h2 {
    text-align: center;
    margin: 0 0 1rem 0;
  }
  .clock {
    text-align: center;
    font-size: 1.8rem;
    font-weight: bold;
    margin-bottom: 0.3rem;
  }
  #dayPartIcon {
    text-align: center;
    margin-bottom: 0.6rem;
    width: 80px;
    height: 80px;
    margin-left: auto;
    margin-right: auto;
  }
  .location,
  .next-prayer {
    text-align: center;
    margin: 0.4rem 0;
  }
  .prayer-bar {
    position: relative;
    height: 38px;
    border-radius: 70px;
    margin: 10px 0 10px;
    overflow: hidden;
    user-select: none;
  }
  .prayer-fill {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    transition: width 0.5s;
  }
  .prayer-text {
    position: absolute;
    width: 90%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 10px;
    font-weight: bold;
    color: #fff;
    text-shadow: 1px 1px 2px #000c;
  }
  .error {
    text-align: center;
    color: crimson;
  }

  /* Animations for icons */

  /* Light bulb glow */
  .lightbulb-glow {
    filter: drop-shadow(0 0 5px rgba(255, 247, 183, 0.7));
    animation: glowPulse 2s ease-in-out infinite;
  }
  @keyframes glowPulse {
    0%,
    100% {
      filter: drop-shadow(0 0 5px rgba(255, 247, 183, 0.7));
    }
    50% {
      filter: drop-shadow(0 0 12px rgba(255, 247, 183, 1));
    }
  }

  /* Sun rays rotate */
  .sun-rays {
    transform-origin: 50% 50%;
    animation: rotateRays 10s linear infinite;
  }
  @keyframes rotateRays {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* Noon sun rotation */
  .noon-sun {
    transform-origin: 50% 50%;
    animation: noonRotate 20s linear infinite;
  }
  @keyframes noonRotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(-360deg);
    }
  }

  /* Sunset wave animate */
  .wave {
    animation: waveMove 3s ease-in-out infinite alternate;
  }
  @keyframes waveMove {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(6px);
    }
  }

  /* Star blinking opacity only (no scaling), increased transparency */
  .star {
    animation: blink 4s infinite linear;
    opacity: 0.3;
  }
  @keyframes blink {
    0%,
    100% {
      opacity: 0.3;
    }
    50% {
      opacity: 1;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <h2>ðŸ•Œ Salah Prayer Clock</h2>
    <div class="clock" id="clock"></div>
    <div id="dayPartIcon" aria-live="polite"></div>
    <div class="location" id="location">Fetching locationâ€¦</div>
    <div class="next-prayer" id="nextPrayer" aria-live="polite"></div>
    <div id="prayerBars"></div>
    <div class="error" id="error" role="alert"></div>
  </div>

<script>
  let prayerTimes = [];
  let currentPrayerIndex = -1;
  // Vibrant bar colors:
  const colors = ['#38bdf8', '#65a30d', '#c026d3', '#fb7185', '#fbbf24', '#16a34a'];

  function pad(n) {
    return n < 10 ? '0' + n : n;
  }

  function to12h(timeStr) {
    let [h, m] = timeStr.split(':').map(Number);
    let period = h >= 12 ? 'PM' : 'AM';
    h = h % 12;
    if (h === 0) h = 12;
    return `${h}:${pad(m)} ${period}`;
  }

  // Inline SVG icons for different day parts (animated)
  const iconsSVG = {
    morningLight: `
      <svg viewBox="0 0 64 64" class="lightbulb-glow" xmlns="http://www.w3.org/2000/svg" fill="#ffeb3b" width="80" height="80" aria-label="Morning Light Icon" role="img" >
        <path d="M32 2c-8 0-14 6-14 14 0 7.5 10 22 10 22h8s10-14.5 10-22c0-8-6-14-14-14z"/>
        <rect x="26" y="42" width="12" height="10" fill="#fecb00" />
        <rect x="28" y="52" width="8" height="8" fill="#fdd835"/>
      </svg>`,
    sunMorning: `
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="#fbbf24" width="80" height="80" aria-label="Morning Sun Icon" role="img">
        <circle cx="32" cy="32" r="14" />
        <g class="sun-rays" stroke="#fbbf24" stroke-width="3">
          <line x1="32" y1="2" x2="32" y2="14" />
          <line x1="32" y1="50" x2="32" y2="62" />
          <line x1="2" y1="32" x2="14" y2="32" />
          <line x1="50" y1="32" x2="62" y2="32" />
          <line x1="12" y1="12" x2="20" y2="20" />
          <line x1="44" y1="44" x2="52" y2="52" />
          <line x1="12" y1="52" x2="20" y2="44" />
          <line x1="44" y1="20" x2="52" y2="12" />
        </g>
      </svg>`,
    sunNoon: `
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="#fcd34d" width="80" height="80" aria-label="Noon Sun Icon" role="img">
        <circle cx="32" cy="32" r="14" />
        <g class="noon-sun" stroke="#f59e0b" stroke-width="3">
          <line x1="32" y1="0" x2="32" y2="12" />
          <line x1="32" y1="52" x2="32" y2="64" />
          <line x1="0" y1="32" x2="12" y2="32" />
          <line x1="52" y1="32" x2="64" y2="32" />
        </g>
        <circle cx="32" cy="32" r="6" fill="#f59e0b" />
      </svg>`,
    sunset: `
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" width="80" height="80" aria-label="Sunset Icon" role="img">
        <circle cx="32" cy="26" r="10" fill="#fb923c"/>
        <path class="wave" fill="#f97316" d="M0,38 Q15,30 32,36 T64,38 L64,64 L0,64 Z"/>
        <rect x="27" y="38" width="10" height="4" fill="#ea580c"/>
      </svg>`,
    nightStars: `
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="#fce96a" width="80" height="80" aria-label="Night Stars Icon" role="img">
        <path class="star" d="M14 12 L16.5 17 L22 18 L17 22 L18 28 L14 25 L10 28 L11 22 L6 18 L12 17 Z" />
        <path class="star" d="M40 20 L42.5 25 L48 26 L43 30 L44 36 L40 33 L36 36 L37 30 L32 26 L38 25 Z" />
        <path class="star" d="M50 10 L52.5 15 L58 16 L53 20 L54 26 L50 23 L46 26 L47 20 L42 16 L48 15 Z" />
        <path class="star" d="M30 38 L32.5 43 L38 44 L33 48 L34 54 L30 51 L26 54 L27 48 L22 44 L28 43 Z" />
        <path class="star" d="M48 45 L50.5 50 L56 51 L51 55 L52 61 L48 58 L44 61 L45 55 L40 51 L46 50 Z" />
        <path class="star" d="M20 48 L22.5 53 L28 54 L23 58 L24 64 L20 61 L16 64 L17 58 L12 54 L18 53 Z" />
      </svg>`
  };

  function showClock() {
    const now = new Date();
    let hr = now.getHours(),
      min = now.getMinutes(),
      sec = now.getSeconds();
    let period = hr >= 12 ? 'PM' : 'AM';
    hr = hr % 12;
    if (hr === 0) hr = 12;
    document.getElementById('clock').textContent = `${pad(hr)}:${pad(min)}:${pad(sec)} ${period}`;
    updateDayPartIcon();
    updateBackgroundByTime();
  }

  function setRandomStarDelays() {
    const stars = document.querySelectorAll('#dayPartIcon svg .star');
    stars.forEach((star) => {
      const delay = (Math.random() * 4).toFixed(2);
      star.style.animationDelay = `${delay}s`;
    });
  }

  function updateDayPartIcon() {
    const hour = new Date().getHours();
    const iconEl = document.getElementById('dayPartIcon');
    let iconHTML = '';
    if (hour >= 5 && hour < 8) iconHTML = iconsSVG.morningLight;
    else if (hour >= 8 && hour < 12) iconHTML = iconsSVG.sunMorning;
    else if (hour >= 12 && hour < 16) iconHTML = iconsSVG.sunNoon;
    else if (hour >= 16 && hour < 19) iconHTML = iconsSVG.sunset;
    else iconHTML = iconsSVG.nightStars;
    iconEl.innerHTML = iconHTML;
    setRandomStarDelays();
  }

  function updateBackgroundByTime() {
    const hour = new Date().getHours();
    const body = document.body;

    if (hour >= 19 || hour < 5) {
      // Night
      body.style.background = '#000000'; // black
      body.style.color = '#eeeeee';      // light text for contrast
    } else if (hour >= 5 && hour < 8) {
      // Early morning
      body.style.background = '#ffffff'; // white
      body.style.color = '#222222';
    } else if (hour >= 8 && hour < 12) {
      // Morning - White
      body.style.background = '#ffffff'; // white
      body.style.color = '#222222';
    } else if (hour >= 12 && hour < 16) {
      // Noon - sky blueish white
      body.style.background = '#dbefff'; // light sky blue white
      body.style.color = '#222222';
    } else if (hour >= 16 && hour < 19) {
      // Evening - orange whitish
      body.style.background = '#fff4e1'; // soft orange-white
      body.style.color = '#222222';
    } else {
      // Default fallback
      body.style.background = '#ffffff';
      body.style.color = '#222222';
    }
  }

  function fetchPrayerTimes(lat, lon) {
    const url = `https://api.aladhan.com/v1/timings/${Math.floor(Date.now() / 1000)}?latitude=${lat}&longitude=${lon}&method=2`;
    fetch(url)
      .then((resp) => resp.json())
      .then((data) => {
        if (!data.data) throw new Error('Unable to get times');
        const times = data.data.timings;
        const prayers = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
        prayerTimes = prayers.map((p) => ({ name: p, time: times[p] }));
        document.getElementById('location').textContent = data.data.meta.timezone || '';
        renderPrayerBars();
        updateProgressBars();
      })
      .catch(() => {
        document.getElementById('error').textContent = 'Could not get prayer times. Please allow location.';
      });
  }

  function renderPrayerBars() {
    const bars = document.getElementById('prayerBars');
    bars.innerHTML = '';
    prayerTimes.forEach((p, idx) => {
      const bar = document.createElement('div');
      bar.className = 'prayer-bar';
      bar.innerHTML = `
        <div class="prayer-fill" id="fill-${idx}" style="background:${colors[idx % colors.length]}; width:0%"></div>
        <div class="prayer-text">${p.name} <span>${to12h(p.time)}</span></div>
      `;
      bars.appendChild(bar);
    });
  }

  function updateProgressBars() {
    if (prayerTimes.length < 2) return;
    const now = new Date();
    let nextIdx = -1;
    for (let i = 0; i < prayerTimes.length; i++) {
      let [h, m] = prayerTimes[i].time.split(':').map(Number);
      let t = new Date(now);
      t.setHours(h, m, 0, 0);
      if (now < t && nextIdx === -1) {
        nextIdx = i;
        break;
      }
    }
    if (nextIdx === -1) nextIdx = 0;
    currentPrayerIndex = (nextIdx - 1 + prayerTimes.length) % prayerTimes.length;
    const curr = prayerTimes[currentPrayerIndex],
      next = prayerTimes[nextIdx];

    let currDate = new Date(now),
      [ch, cm] = curr.time.split(':').map(Number),
      [nh, nm] = next.time.split(':').map(Number);
    currDate.setHours(ch, cm, 0, 0);
    if (currDate > now) currDate.setDate(currDate.getDate() - 1);
    let nextDate = new Date(currDate);
    nextDate.setHours(nh, nm, 0, 0);
    if (nextDate <= currDate) nextDate.setDate(nextDate.getDate() + 1);

    const total = nextDate - currDate;
    const elapsed = now - currDate;
    const perc = Math.max(0, Math.min(100, (elapsed / total) * 100));

    prayerTimes.forEach((p, idx) => {
      document.getElementById(`fill-${idx}`).style.width =
        idx === currentPrayerIndex ? `${(100 - perc).toFixed(1)}%` : '100%';
      document.getElementById(`fill-${idx}`).style.opacity = idx === currentPrayerIndex ? '1' : '0.35';
    });

    // Countdown in HH:MM:SS format
    let diff = Math.floor((nextDate - now) / 1000);
    let hours = Math.floor(diff / 3600);
    let mins = Math.floor((diff % 3600) / 60);
    let secs = diff % 60;
    document.getElementById('nextPrayer').textContent =
      `Next: ${next.name} in ${pad(hours)}:${pad(mins)}:${pad(secs)}`;
  }

  function detectLocation() {
    if ('geolocation' in navigator) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          fetchPrayerTimes(pos.coords.latitude, pos.coords.longitude);
        },
        () => {
          document.getElementById('error').textContent = 'Allow location to get accurate times.';
        }
      );
    } else {
      document.getElementById('error').textContent = 'Geolocation not supported.';
    }
  }

  setInterval(showClock, 1000);
  setInterval(updateProgressBars, 1000);
  detectLocation();
  showClock();
</script>
</body>
</html>
